[SCENARIO]
Family: F7 (Network and Multi Echelon)
Archetype: retail_f7_multiechelon_chain
Scenario ID: retail_f7_multiechelon_chain_v1

[BUSINESS DESCRIPTION]
Business narrative:
The network is an explicit three-echelon chain consisting of a plant, distribution centers, and retail stores. Demand occurs only at stores; the plant and distribution centers act purely as upstream nodes that hold and move inventory. Customers are never backordered: store demand that cannot be met from store inventory is lost and penalized.

Structure cues:
- Locations: Plant (upstream), DC1/DC2 (distribution centers), Store1/Store2/Store3 (retail). The transshipment network defines directed edges: Plant→DC1, Plant→DC2, DC1→Store1, DC1→Store2, DC2→Store2, DC2→Store3.
- Shelf life: Each product has a shelf life in periods. Inventory must be tracked by REMAINING LIFE.

  DECISION VARIABLES - define EXACTLY as specified:
  - Q[p,l,t] = order quantity for product p at location l in period t
    CRITICAL: Q is indexed over (products, locations, periods), NOT just (products, periods)!
    Define as: Q = m.addVars(P, L, T, ...) NOT m.addVars(P, T, ...)
  - I[p,l,t,r] = inventory at START of period t with r periods remaining
  - sales[p,l,t,r] = units sold from inventory cohort with r remaining life
  - W[p,l,t] = waste (expired units)
  - L[p,l,t] = lost sales (unmet demand)

  Convention: r=1 is OLDEST (sell first FIFO), r=shelf_life[p] is FRESHEST.

  KEY EQUATIONS - implement EXACTLY as written, do NOT add or remove terms:

  (1) Fresh inflow: I[p,l,t,SL] = Q[p,l,t]
      - Each location places its OWN orders. Q[p,l,t] is already per-location.
      - Do NOT multiply by demand_share. demand_share is ONLY for calculating demand values.

  (2) Aging: I[p,l,t+1,r] = I[p,l,t,r+1] - sales[p,l,t,r+1] for r=1..SL-1
      - Inventory tomorrow with r remaining = inventory today with r+1 remaining - sales

  (3) Waste: W[p,l,t] = I[p,l,t,1] - sales[p,l,t,1]
      - Items with r=1 that aren't sold become waste

  (4) Sales availability: sales[p,l,t,r] <= I[p,l,t,r]
      - Can only sell what you have in inventory

  (5) Inventory holding cost: charged on (I[p,l,t,r] - sales[p,l,t,r]) for r >= 2
      - Charge on END-of-period inventory (after sales), exclude expiring items (r=1)
- Storage capacity: sum over products of (cold_usage[p] * total_inventory[p,l,t]) <= cold_capacity[l]. Capacities differ by echelon: Plant=8000, DC1/DC2=4000, Stores=600.
- Inventory is allowed to flow only along the directed edges. There is no direct shipment between stores, between distribution centers, or from stores back upstream.
- Demand occurs only at store nodes according to demand_share (Store1=30%, Store2=40%, Store3=30%). Upstream nodes (Plant, DCs) do not face direct customer demand.
- For each product, location, and period, inventory reflects previous stock, production or inbound shipments, outbound shipments, sales at stores, and waste, and must remain non-negative.
- Lost sales occur only at store nodes when local demand cannot be served from available inventory, even after receiving shipments from upstream.
- The objective is to minimize total cost including holding at all echelons, transshipment, waste, and lost sales, subject to the three-echelon topology.
