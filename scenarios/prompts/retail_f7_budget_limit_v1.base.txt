[SCENARIO]
Family: F7 (Network and Multi Echelon)
Archetype: retail_f7_budget_limit
Scenario ID: retail_f7_budget_limit_v1

[BUSINESS DESCRIPTION]
Business narrative:
The retailer faces a per-period open-to-buy budget that limits total spending on inventory-related activities across the network. This budget must cover purchasing and possibly other variable costs, coupling decisions across locations in each period. Demand is local and exogenous, and unmet demand is lost and penalized.

Structure cues:
- The underlying network is the same single-echelon structure with potential transshipment and storage capacity as in the base network for this family.
- Shelf life: Each product has a shelf life in periods. Inventory must be tracked by REMAINING LIFE.

  DECISION VARIABLES - define EXACTLY as specified:
  - Q[p,l,t] = order quantity for product p at location l in period t
    CRITICAL: Q is indexed over (products, locations, periods), NOT just (products, periods)!
    Define as: Q = m.addVars(P, L, T, ...) NOT m.addVars(P, T, ...)
  - I[p,l,t,r] = inventory at START of period t with r periods remaining
  - sales[p,l,t,r] = units sold from inventory cohort with r remaining life
  - W[p,l,t] = waste (expired units)
  - L[p,l,t] = lost sales (unmet demand)

  Convention: r=1 is OLDEST (sell first FIFO), r=shelf_life[p] is FRESHEST.

  KEY EQUATIONS - implement EXACTLY as written, do NOT add or remove terms:

  (1) Fresh inflow: I[p,l,t,SL] = Q[p,l,t]
      - Each location places its OWN orders. Q[p,l,t] is already per-location.
      - Do NOT multiply by demand_share. demand_share is ONLY for calculating demand values.

  (2) Aging: I[p,l,t+1,r] = I[p,l,t,r+1] - sales[p,l,t,r+1] for r=1..SL-1
      - Inventory tomorrow with r remaining = inventory today with r+1 remaining - sales

  (3) Waste: W[p,l,t] = I[p,l,t,1] - sales[p,l,t,1]
      - Items with r=1 that aren't sold become waste

  (4) Sales availability: sales[p,l,t,r] <= I[p,l,t,r]
      - Can only sell what you have in inventory

  (5) Inventory holding cost: charged on (I[p,l,t,r] - sales[p,l,t,r]) for r >= 2
      - Charge on END-of-period inventory (after sales), exclude expiring items (r=1)
- Storage capacity: sum over products of (cold_usage[p] * total_inventory[p,l,t]) <= cold_capacity[l]. These limits must be respected.
- The JSON specifies budget_per_period=10000. For each period, the total purchasing spend (order quantity times purchasing cost) plus any fixed ordering costs if enabled must not exceed this budget.
- Inventory balance for each product, location, and period follows the standard pattern with production or inbound shipments, outbound shipments, sales, and waste, and inventory must remain non-negative.
- The budget constraint must be encoded so that spending above the budget is not allowed in any period.
- The transshipment network and lead times match the base network archetype for this family.
- The objective is to minimize total cost while respecting the period-by-period budget caps.
