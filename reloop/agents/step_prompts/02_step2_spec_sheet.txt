STEP 2 - BUILD THE MODEL SPEC SHEET

Task:
Produce a structured model specification based on Step1 contract and data_profile.

Output: Single JSON object. No surrounding text, no markdown.

=============================================================================
SCHEMA (all fields required)
=============================================================================

{
  "sets": [
    {"name": "...", "description": "...", "source": "data.xxx"}
  ],

  "decisions": [
    {"name": "...", "type": "continuous|integer|binary", "domain": ">=0", 
     "indices": [...], "meaning": "...", "active_if": "condition or always"}
  ],

  "objective_terms": [
    {"name": "...", "expression": "semantic description of this cost term", 
     "source": "costs.xxx", "active_if": "condition or always"}
  ],

  "constraint_families": [
    {"prefix": "...", "meaning": "one sentence description", 
     "indices": [...], "sense": "<=|=|>=", "active_if": "condition or always"}
  ],

  "edge_cases": [
    {"case": "boundary condition", "handling": "how to handle"}
  ],

  "open_questions": []
}

=============================================================================
SETS TO DEFINE
=============================================================================

- P: products (from data.products)
- L: locations (from data.locations)
- T: time periods 1 to data.periods
- A: remaining life buckets 1 to shelf_life[p] for each product

=============================================================================
DECISION VARIABLES
=============================================================================

Core variables (always needed):
- I: inventory indexed by [p, l, t, a] - must include life bucket index
- y: sales indexed by [p, l, t, a] - sales from each life bucket
- W: waste indexed by [p, l, t] - expired inventory
- Q: orders/production indexed by [p, l, t]
- L: lost sales indexed by [p, l, t] - CRITICAL: this is the slack variable

Conditional variables:
- S: substitution flow indexed by [p_from, p_to, l, t] - only if sub_edges nonempty

=============================================================================
OBJECTIVE TERMS
=============================================================================

For each cost term, provide a semantic description in the "expression" field.
Describe WHAT the cost represents, not the mathematical formula.

- purchasing_cost: cost incurred when ordering/producing units
- inventory_holding: cost of holding END-OF-PERIOD inventory (I - y), only for buckets a >= 2
  NOTE: I is START-of-period inventory, y is sales, so (I - y) is END-of-period
- waste_cost: penalty for units that expire from bucket a=1
- lost_sales_penalty: penalty for demand that cannot be fulfilled

=============================================================================
CONSTRAINT FAMILIES
=============================================================================

Identify each constraint family by its PURPOSE:

Balance constraints:
- demand_route: limits how much demand can be redirected to substitutes
- sales_conservation: ensures sales + lost = effective demand

Availability constraints:
- availability: sales from a bucket cannot exceed inventory in that bucket

Dynamics constraints:
- aging: how inventory moves between life buckets over time
- expire_clear: defines waste as unsold expiring inventory
- fresh_inflow: how new inventory enters the freshest bucket

Capacity constraints:
- storage_cap: total inventory limited by cold storage capacity
- prod_cap: total production limited by capacity

=============================================================================
EDGE CASES TO DOCUMENT
=============================================================================

- t=1 initialization: non-fresh buckets must start empty
- t=T boundary: no aging constraints (would reference t+1)
- lead_time handling: fresh inflow depends on past orders

=============================================================================
SUBSTITUTION SEMANTICS
=============================================================================

sub_edges = [[p_from, p_to], ...] means p_from's demand can be served by p_to.
S[p_from, p_to, l, t] = quantity of p_from's demand served by p_to.

Conceptually:
- outbound[p]: substitution where p is the source (p's demand served by others)
- inbound[p]: substitution where p is the target (p serves others' demand)

=============================================================================
CRITICAL RULES
=============================================================================

- Do NOT create variable 'd' for demand - compute demand directly
- L (lost sales) MUST be included as a decision variable
- I and y MUST have index 'a' for remaining life bucket
- S only exists when sub_edges is nonempty
- Every field in schema is REQUIRED
- The "expression" field should contain semantic descriptions, not mathematical formulas